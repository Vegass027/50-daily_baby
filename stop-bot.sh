#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–æ—Ç–∞

echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞..."

# –ü—ã—Ç–∞–µ–º—Å—è –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞ —á–µ—Ä–µ–∑ SIGINT (graceful shutdown)
pkill -INT -f "ts-node.*bot.ts"

# –ñ–¥–µ–º 5 —Å–µ–∫—É–Ω–¥
sleep 5

# –ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –≤—Å–µ –µ—â–µ –∂–∏–≤ - —É–±–∏–≤–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ
if pgrep -f "ts-node.*bot.ts" > /dev/null; then
    echo "‚ö†Ô∏è  –ë–æ—Ç –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è, —É–±–∏–≤–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ..."
    pkill -9 -f "ts-node.*bot.ts"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å —É–±–∏—Ç
if pgrep -f "ts-node.*bot.ts" > /dev/null; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ø—Ä–æ—Ü–µ—Å—Å –±–æ—Ç–∞ –≤—Å–µ –µ—â–µ –∑–∞–ø—É—â–µ–Ω"
    exit 1
else
    echo "‚úÖ –ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
fi
