# –≠—Ç–∞–ø 4: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ Priority Fees

## üéØ –¶–µ–ª–∏

1.  –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç priority fees –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å–µ—Ç–∏ —Å –ø–æ–º–æ—â—å—é `getRecentPrioritizationFees`.
2.  –°–æ–∑–¥–∞—Ç—å `PriorityFeeCalculator` –¥–ª—è –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–∏ —ç—Ç–æ–π –ª–æ–≥–∏–∫–∏.
3.  –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç—Ä–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏: `low`, `normal`, `aggressive`.
4.  –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `/set_speed [strategy]` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç—å—é.
5.  –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å priority fees –≤–æ –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–ø–æ–∫—É–ø–∫–∞/–ø—Ä–æ–¥–∞–∂–∞).

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
DEX_BOT/
‚îî‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ trading/
    ‚îÇ   ‚îî‚îÄ‚îÄ PriorityFeeCalculator.ts
    ‚îú‚îÄ‚îÄ config/
    ‚îÇ   ‚îî‚îÄ‚îÄ constants.ts
    ‚îî‚îÄ‚îÄ bot.ts
```

## üìù –ö–ª—é—á–µ–≤—ã–µ —à–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1.  **`src/trading/PriorityFeeCalculator.ts`**:
    -   –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å `PriorityFeeCalculator`.
    -   **`getOptimalPriorityFee(tokenMint, strategy)`**:
        -   –í—ã–∑—ã–≤–∞–µ—Ç `connection.getRecentPrioritizationFees`, –ø–µ—Ä–µ–¥–∞–≤–∞—è –∞–¥—Ä–µ—Å —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞.
        -   –§–∏–ª—å—Ç—Ä—É–µ—Ç –Ω—É–ª–µ–≤—ã–µ –∫–æ–º–∏—Å—Å–∏–∏.
        -   –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∏—Å—Å–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (`low`, `normal`, `aggressive`), –∫–∞–∫ –æ–ø–∏—Å–∞–Ω–æ –≤ –≥–∞–π–¥–µ.
        -   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–º–∏—Å—Å–∏—é –≤ **–º–∏–∫—Ä–æ-–ª–∞–º–ø–æ—Ä—Ç–∞—Ö**.
        -   –î–æ–±–∞–≤–ª—è–µ—Ç fallback-–∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ RPC-–≤—ã–∑–æ–≤ –Ω–µ —É–¥–∞—Å—Ç—Å—è.

2.  **`src/bot.ts`**:
    -   –î–æ–±–∞–≤–∏—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–º–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å —Å –ø—Ä–æ—Å—Ç–æ–≥–æ `Map<userId, UserSettings>`).
    -   **`/set_speed [strategy]`**:
        -   –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç, —á—Ç–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–¥–Ω–∞ –∏–∑ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö (`low`, `normal`, `aggressive`).
        -   –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        -   –û—Ç–≤–µ—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± —É—Å–ø–µ—Ö–µ.
    -   **`/settings`**:
        -   –†–∞—Å—à–∏—Ä–∏—Ç—å —ç—Ç—É –∫–æ–º–∞–Ω–¥—É, —á—Ç–æ–±—ã –æ–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞ —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Å–∫–æ—Ä–æ—Å—Ç–∏.

3.  **`src/trading/SwapManager.ts`**:
    -   –ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ–±–º–µ–Ω–∞, –≤—ã–∑—ã–≤–∞—Ç—å `priorityFeeCalculator.getOptimalPriorityFee()`.
    -   –°–æ–∑–¥–∞–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è priority fee:
        ```typescript
        import { ComputeBudgetProgram } from '@solana/web3.js';

        const priorityFeeInstruction = ComputeBudgetProgram.setComputeUnitPrice({
          microLamports: calculatedFee,
        });
        ```
    -   –î–æ–±–∞–≤–ª—è—Ç—å —ç—Ç—É –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é **–ø–µ—Ä–≤–æ–π** –≤ –º–∞—Å—Å–∏–≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —á—Ç–æ–±—ã –æ–Ω–∞ –±—ã–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å.

4.  **`src/config/constants.ts`**:
    -   –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä, `DEFAULT_SPEED_STRATEGY`.

5.  **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`)**:
    -   –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è RPC-–ø—Ä–æ–≤–∞–π–¥–µ—Ä, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π `getRecentPrioritizationFees` (–Ω–∞–ø—Ä–∏–º–µ—Ä, QuickNode –∏–ª–∏ Helius).
    -   –î–æ–±–∞–≤–∏—Ç—å `DEFAULT_SPEED_STRATEGY` –≤ `.env` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.