# –≠—Ç–∞–ø 6: –õ–∏–º–∏—Ç–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞ —Å Take Profit

## üéØ –¶–µ–ª–∏

1.  –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å Jupiter Limit Order API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –æ—Ç–º–µ–Ω—ã –æ—Ä–¥–µ—Ä–æ–≤.
2.  –°–æ–∑–¥–∞—Ç—å `LimitOrderManager` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ–º –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –ª–∏–º–∏—Ç–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤.
3.  –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É `/limit_order [tokenMint] [amount] [priceSOL] [takeProfit%]`.
4.  –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–π `sell` –æ—Ä–¥–µ—Ä —Å –∑–∞–¥–∞–Ω–Ω—ã–º –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º –ø—Ä–æ—Ñ–∏—Ç–∞ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è `buy` –æ—Ä–¥–µ—Ä–∞.
5.  –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã `/cancel_orders` –∏ `/my_orders`.
6.  –°–æ–∑–¥–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
DEX_BOT/
‚îî‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ trading/
    ‚îÇ   ‚îî‚îÄ‚îÄ LimitOrderManager.ts
    ‚îú‚îÄ‚îÄ data/
    ‚îÇ   ‚îî‚îÄ‚îÄ open_orders.json
    ‚îî‚îÄ‚îÄ bot.ts (–º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è)
```

## üìù –ö–ª—é—á–µ–≤—ã–µ —à–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1.  **`src/trading/LimitOrderManager.ts`**:
    -   –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å `LimitOrderManager`.
    -   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Jupiter API (`@jup-ag/api`) –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º–æ–π –ª–∏–º–∏—Ç–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤.
    -   **`createLimitOrder(orderParams)`**:
        -   –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ä–¥–µ—Ä–∞ (—Ç–æ–∫–µ–Ω, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Ü–µ–Ω–∞).
        -   –†–µ–∞–ª–∏–∑—É–µ—Ç –ª–æ–≥–∏–∫—É **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ approve** —Ç–æ–∫–µ–Ω–æ–≤, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ (–¥–ª—è sell-–æ—Ä–¥–µ—Ä–æ–≤). Jupiter API —á–∞—Å—Ç–æ —Ç—Ä–µ–±—É–µ—Ç `createOpenOrders` –∏ `token.approve`.
        -   –§–æ—Ä–º–∏—Ä—É–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ª–∏–º–∏—Ç–Ω–æ–≥–æ –æ—Ä–¥–µ—Ä–∞.
    -   **`createTakeProfitOrder(buyOrder, takeProfitPercent)`**:
        -   –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ü–µ–Ω—É –ø—Ä–æ–¥–∞–∂–∏: `sellPrice = buyPrice * (1 + takeProfitPercent / 100)`.
        -   –í—ã–∑—ã–≤–∞–µ—Ç `createLimitOrder` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è `sell` –æ—Ä–¥–µ—Ä–∞.
    -   **`cancelOrder(orderId)`**:
        -   –û—Ç–º–µ–Ω—è–µ—Ç –æ—Ä–¥–µ—Ä –ø–æ –µ–≥–æ ID.
    -   **`getOpenOrders(owner)`**:
        -   –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤ –¥–ª—è –∫–æ—à–µ–ª—å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

2.  **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤ (`src/data/open_orders.json`)**:
    -   –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π JSON-—Ñ–∞–π–ª –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ—Ä–¥–µ—Ä–∞—Ö.
    -   –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø–∏—Å–∏:
        ```json
        {
          "buyOrderId": "...",
          "sellOrderId": "...",
          "status": "active",
          "tokenMint": "...",
          "buyPrice": 0.5,
          "sellPrice": 0.75,
          "userId": 123456789
        }
        ```
    -   –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å-–º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å race conditions –ø—Ä–∏ –∑–∞–ø–∏—Å–∏.

3.  **`src/bot.ts`**:
    -   **`/limit_order [tokenMint] [amount] [priceSOL] [takeProfit%]`**:
        -   –ü–∞—Ä—Å–∏—Ç –≤—Å–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã.
        -   –í—ã–∑—ã–≤–∞–µ—Ç `limitOrderManager.createLimitOrder` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è `buy` –æ—Ä–¥–µ—Ä–∞.
        -   –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è `buy` –æ—Ä–¥–µ—Ä–∞, –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç `limitOrderManager.createTakeProfitOrder`.
        -   –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–≤—è–∑–∞–Ω–Ω–æ–π –ø–∞—Ä–µ –æ—Ä–¥–µ—Ä–æ–≤ –≤ `open_orders.json`.
        -   –û—Ç–≤–µ—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± —É—Å–ø–µ—à–Ω–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–≤—É—Ö –æ—Ä–¥–µ—Ä–æ–≤.
    -   **`/cancel_orders`**:
        -   –ß–∏—Ç–∞–µ—Ç `open_orders.json`, –Ω–∞—Ö–æ–¥–∏—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        -   –í—ã–∑—ã–≤–∞–µ—Ç `limitOrderManager.cancelOrder` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ—Ä–¥–µ—Ä–∞ (–∏ –¥–ª—è `buy`, –∏ –¥–ª—è `sell`).
        -   –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ JSON-—Ñ–∞–π–ª–µ.
    -   **`/my_orders`**:
        -   –ß–∏—Ç–∞–µ—Ç `open_orders.json` –∏ –∫—Ä–∞—Å–∏–≤–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

4.  **–§–æ–Ω–æ–≤—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**:
    -   –í `LimitOrderManager` –∏–ª–∏ –≤ `bot.ts` –∑–∞–ø—É—Å—Ç–∏—Ç—å `setInterval` (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥).
    -   –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å `limitOrderManager.getOpenOrders`, —Å–≤–µ—Ä—è—Ç—å —Å–æ —Å–ø–∏—Å–∫–æ–º –≤ `open_orders.json` –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å—ã –∏—Å–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤.